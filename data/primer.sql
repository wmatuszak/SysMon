BEGIN TRANSACTION;
CREATE TABLE tblCred (CredID INTEGER PRIMARY KEY, CredUser TEXT, CredPass TEXT, CredDesc TEXT);
CREATE TABLE tblHost (HostID INTEGER PRIMARY KEY, StateID NUMERIC, HostIP TEXT, HostName TEXT, HostMonitor NUMERIC, CredID NUMERIC, OperSysID NUMERIC, HostLastSeen NUMERIC, HostAlert TEXT);
CREATE TABLE tblOperSys (OperSysID INTEGER PRIMARY KEY, OperSysString TEXT, OperSysDefaultProbes TEXT);
CREATE TABLE tblState (StateID INTEGER PRIMARY KEY, StateDesc TEXT);
CREATE TABLE tblProbe (ProbeID INTEGER PRIMARY KEY, ProbeCmd TEXT, ProbePost TEXT, ProbeEval TEXT, ProbeConst TEXT, ProbeAlert TEXT);
CREATE TABLE tblPayload (PayloadID INTEGER PRIMARY KEY, HostID NUMERIC, ProbeID NUMERIC);
INSERT INTO tblState VALUES(1,'Down');
INSERT INTO tblState VALUES(2,'Up');
INSERT INTO tblState VALUES(3,'Stale');
INSERT INTO tblState VALUES(4,'Alert');
INSERT INTO tblOperSys VALUES(1,'Windows','4 5 6');
INSERT INTO tblOperSys VALUES(2,'Linux','1 2 3');
INSERT INTO tblProbe VALUES(1,'sshpass -p "%P" ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no %U@%H df -h -x tmpfs -x devtmpfs','grep -o -E [0-9][0-9]%\|[0-9]% | rev | cut -c 2- | rev','GT','85','[Free Disk Space Alert]');
INSERT INTO tblProbe VALUES(2,'sshpass -p "%P" ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no %U@%H cat /proc/meminfo','grep "MemFree\|MemTotal" > /tmp/meminfo.tmp; echo "scale = 2; `cat /tmp/meminfo.tmp | grep MemFree | grep -o [0-9]*` / `cat /tmp/meminfo.tmp | grep MemTotal | grep -o [0-9]*`" | bc | grep -o [0-9]*; rm /tmp/meminfo.tmp;','LT','10','[Free Memory Space Alert]');
INSERT INTO tblProbe VALUES(3,'sshpass -p "%P" ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no %U@%H uptime','grep -o [0-9].[0-9][0-9] | tail -n 1 | sed "s/\.//g"','GT','90','[CPU Usage Alert]');
INSERT INTO tblProbe VALUES(4,'wmic -U %U%"%P" //%H "Select FreeSpace,Size from Win32_LogicalDisk"','grep -v CLASS | grep -o [0-9]* | while read free; do read total; bc <<< "scale = 2; $free / $total" | grep -o [0-9]*; done;','LT','15','[Free Disk Space Alert]');
INSERT INTO tblProbe VALUES(5,'wmic -U %U%"%P" //%H "Select FreeVirtualMemory,TotalVirtualMemorySize from Win32_OperatingSystem"','grep -v CLASS | grep -o [0-9]* | while read free; do read total; bc <<< "scale = 2; $free / $total" | grep -o [0-9]*; done;','LT','10','[Free Memory Space Alert]');
INSERT INTO tblProbe VALUES(6,'wmic -U %U%"%P" //%H "Select LoadPercentage from Win32_Processor"','grep -v CLASS | grep -v DeviceID | sed "s/CPU[0-9]|//g"','GT','90','[CPU Usage Alert]');
INSERT INTO tblProbe VAULES(7,'wmic -U %U%"%P" //%H "Select * from Win32_NTLogEvent Where EventCode=34113 and LogFile='Application' and TimeGenerated>'%W_EW'"','','CN','Job Failure','[BackupExec Job Failure]');
COMMIT;
